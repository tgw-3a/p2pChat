<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>チャット</title>
    <link href="/css/output.css" rel="stylesheet"/>
    <script defer src="/js/libp2p.js"></script>
    <script th:inline="javascript">
        const RELAY_MULTIADDR = [[${relayMultiaddr}]];
    </script>
</head>
<body class="bg-gray-100 text-gray-900 font-sans leading-relaxed">
<main class="container mx-auto p-6 bg-white shadow-md rounded-lg mt-10">
    <h1 class="font-bold text-2xl text-blue-600 mb-4">チャット</h1>
    <h2 th:text="'ようこそ、' + ${nickName} + ' さん！'" class="text-lg mb-4">ようこそ！</h2>
    <div id="chat-box" style="border:1px solid #ccc; height:200px; overflow:auto; margin-bottom:10px;" role="log" aria-live="polite">
    </div>
    <div class="mb-4">
      <span>ステータス: <span id="status-text" class="font-bold text-red-600">オフライン</span></span>
      <button id="go-online" class="bg-green-500 text-white px-2 py-1 rounded ml-4">オンラインになる</button>
      <button id="go-offline" class="bg-gray-500 text-white px-2 py-1 rounded ml-2">オフラインになる</button>
      <p class="text-red-500 text-sm mt-2">
        ※ ブラウザを閉じる前に必ず「オフラインになる」ボタンを押してください。
      </p>
    </div>
    <h3>オンラインの友達</h3>
    <ul id="online-friends-list"></ul>

    <form id="chat-form" novalidate>
        <input type="text" id="chat-input" placeholder="メッセージを入力" style="width:80%;">
        <button type="submit" id="chat-send-button">送信</button>
    </form>

    <ul class="list-disc list-inside mb-6">
        <li>
            Opened sessions in the last <span id="output-webtransport-opened-per-unit">0s</span>:
            <span id="output-webtransport-opened-per-minute">0</span>
        </li>
        <li>
            Max opened connections per minute: <span id="output-webtransport-max-opened-per-minute">0</span>
        </li>
        <li>
            <button id="button-logging-enable" class="bg-blue-500 hover:bg-blue-700 text-white px-1 rounded">Enable
                libp2p Logging
            </button>
            <button id="button-logging-disable" class="bg-red-500 hover:bg-red-700 text-white px-1 rounded">Disable
                libp2p Logging
            </button>
        </li>
    </ul>

    <section class="my-4">
        <h2 class="font-bold text-xl text-blue-600 mb-2">Node</h2>
        <ul class="list-disc list-inside ml-4">
            <li>Peer ID: <span class="font-bold" id="output-node-peer-id">Unknown</span></li>
            <li>Status: <span id="output-node-status">Initialising</span></li>
            <li>
                Connections: <span id="output-peer-count">0</span>
                <ul class="list-disc list-inside ml-6" id="output-peer-types"></ul>
            </li>
            <li>
                Addresses: <span id="output-address-count">0</span>
                <ul class="list-disc list-inside ml-6" id="output-addresses"></ul>
            </li>
        </ul>
    </section>

    <section class="my-6">
        <h2 class="font-bold text-xl text-blue-600 mb-2">Peers</h2>
        <p class="flex flex-row items-center gap-2">
            <label class="block text-gray-700 text-sm font-bold" for="input-multiaddr">Multiaddr</label>
            <input
                    class="shadow appearance-none border rounded w-full py-2 px-2 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="input-multiaddr"
                    type="text"
                    placeholder="/ip4/..."
            />
            <button
                    class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                    id="button-connect"
                    type="button"
            >
                Connect
            </button>
        </p>

        <ul class="list-disc list-inside ml-4" id="output-peer-details"></ul>
    </section>

    <h2 class="font-bold text-xl text-blue-600 mb-2">Output</h2>
    <pre class="bg-gray-100 p-4 rounded shadow-inner" id="output"></pre>

    <hr class="my-6 border-gray-300"/>
</main>
</body>
</html>
